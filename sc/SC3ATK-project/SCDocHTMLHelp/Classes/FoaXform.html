<html><head><title>FoaXform</title><link rel='stylesheet' href='./../scdoc.css' type='text/css' /><meta http-equiv='Content-Type' content='text/html; charset=UTF-8' /><script src='./../scdoc.js' type='text/javascript'></script><script src='./../docmap.js' type='text/javascript'></script><script src='./../prettify.js' type='text/javascript'></script><script src='./../lang-sc.js' type='text/javascript'></script><script type='text/javascript'>var helpRoot='./..';</script></head><ul id='menubar'></ul><body onload='fixTOC();prettyPrint()'><div class='contents'><div class='header'><div id='label'>SuperCollider CLASSES</div><div id='categories'><a href='./../Browse.html#Libraries>Ambisonic Toolkit>FOA>Transforming'>Libraries>Ambisonic Toolkit>FOA>Transforming</a>, <a href='./../Browse.html#UGens>Multichannel>Ambisonics'>UGens>Multichannel>Ambisonics</a></div><h1>FoaXform</h1><div id='summary'>First Order Ambisonic (FOA) matrix transformer</div></div><div class='subheader'>
<div id='filename'>Source: /Users/josephla/Library/Application Support/SuperCollider/Extensions/DXClasses/AtkClasses/<a href='file:///Users/josephla/Library/Application Support/SuperCollider/Extensions/DXClasses/AtkClasses/ATK.sc'>ATK.sc</a></div><div class='inheritance'>Inherits from: <a href="../Classes/Object.html">Object</a></div><div id='related'>See also: <a href="./../Classes/FoaXformerMatrix.html">FoaXformerMatrix</a>, <a href="./../Classes/FoaTransform.html">FoaTransform</a></div>[ <a href='nil'>old help</a> ]</div><div id='toc'>
<ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*ar'>ar</a> </li>
<li class='toc2'><a href='#inherited_class_methods'>Inherited class methods</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc2'><a href='#inherited_instance_methods'>Inherited instance methods</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'><li class='toc2'><a href='#choose_a_decoder'>Choose a decoder</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#rotate'>Rotate</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#mirroro'>MirrorO</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#dominatex'>DominateX</a></li>
<ul class='toc'></ul></ul></ul></div><h2><a class='anchor' name='description'>Description</a></h2>
<p>Transforms (spatial domain filter) a first order ambisonic signal (B-format). <a href="./../Classes/FoaXform.html">FoaXform</a> applies static transforms, for dynamic transforms see <a href="./../Classes/FoaTransform.html">FoaTransform</a>.
<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='cmethodname'><span class='methprefix'><a class='anchor' name='*ar'>*</a></span><a href='./../Overviews/Methods.html#ar'>ar</a> (<span class='argstr'>in</span>, <span class='argstr'>xformer</span>, <span class='argstr'>mul = 1</span>, <span class='argstr'>add = 0</span>)</h3>
<div class='method'><h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'> in <td class='argumentdesc'><p>The B-format signal, an array: [w, x, y, z]
<tr><td class='argumentname'> xformer <td class='argumentdesc'><a href="./../Classes/FoaXformerMatrix.html">FoaXformerMatrix</a> instance.
<tr><td class='argumentname'> mul <td class='argumentdesc'><p>Output will be multiplied by this value.
<tr><td class='argumentname'> add <td class='argumentdesc'><p>This value will be added to the output.
</table><h4>Returns:</h4>
<div class='returnvalue'><p>An array of channels, the transformed B-format signal.
</div></div><h3><a class='anchor' name='inherited_class_methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3><a class='anchor' name='inherited_instance_methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h2><a class='anchor' name='examples'>Examples</a></h2>
<p>The examples below are intended to briefly illustrate some of the first order tranform options made available in the Ambisonic Toolkit. The user is encouraged to carefully review the features of <a href="./../Classes/FoaXformMatrix.html">FoaXformMatrix</a> to gain a deeper understanding of the flexibility of these tools.
<p>Available transformers include rotations, mirroring, directivity (spatial low pass fitering), dominance (image warping), and a variety of dominance related transforms.
<p>As the Ambisonic technique is a hierarchal system, numerous options for playback are possible. These include two channel stereo, two channel binaural, pantophonic and full 3D periphonic. With the examples below, we'll take advantage of this by first choosing a suitable decoder with with to audition.
<h3><a class='anchor' name='choose_a_decoder'>Choose a decoder</a></h3>
<p>A number of decoders are defined below. Please choose one suitable for your system. Also, don't forget to define <code class='code prettyprint lang-sc'> ~renderDecode </code>
 !
<div class='note'><span class='notelabel'>NOTE:</span> If you choose a kernel decoder, <a href="./../Classes/FoaDecoderKernel.html">FoaDecoderKernel</a>, be sure to free the kernel after use. </div><pre class='code prettyprint lang-sc'>
// ------------------------------------------------------------
// switch to internal server, and boot
(
        s = <a class='clslnk' href='./../Classes/Server.html'>Server</a>.internal;
        <a class='clslnk' href='./../Classes/Server.html'>Server</a>.default = s;
        s.boot;
)


// ------------------------------------------------------------
// choose a decoder

// stereophonic / binaural
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.newStereo(131/2 * pi/180, 0.5) // Cardioids at 131 deg
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderKernel.html'>FoaDecoderKernel</a>.newUHJ                         // UHJ (kernel)
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderKernel.html'>FoaDecoderKernel</a>.newSpherical                   // synthetic binaural (kernel)
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderKernel.html'>FoaDecoderKernel</a>.newCIPIC                       // KEMAR binaural (kernel)


// pantophonic (2D)
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.newQuad(k: 'dual')             // psycho optimised quad
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.newQuad(pi/6, 'dual')          // psycho optimised narrow quad
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.new5_0                         // 5.0
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.newPanto(6, k: 'dual')         // psycho optimised hex


// periphonic (3D)
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.newPeri(k: 'dual')             // psycho optimised cube
~decoder = <a class='clslnk' href='./../Classes/FoaDecoderMatrix.html'>FoaDecoderMatrix</a>.newDiametric(                  // psycho optimised bi-rectangle
    pi/180 * [[30, 0], [-30, 0], [90, 35.3], [-90, 35.3]],
    'dual'
)


// inspect
~decoder.kind


// ------------------------------------------------------------
// define ~renderDecode
(
~renderDecode = { arg in, decoder;
    var kind;
    var fl, bl, br, fr;
    var fc, lo;
    var sl, sr;
    var flu, blu, bru, fru;
    var fld, bld, brd, frd;
    var slu, sru, sld, srd;

    kind = decoder.kind;
    
    "in renderDecode".postln;
    kind.postln;
        
    case
        { decoder.numChannels == 2 }
            {
	            
	            "in stereo".postln;
	            
                // decode to stereo (or binaural)
                <a class='clslnk' href='./../Classes/FoaDecode.html'>FoaDecode</a>.ar(in, ~decoder)
            }
        { kind == 'quad' }
            {
	            "in quad".postln;
	            
                // decode (to quad)
                #fl, bl, br, fr = <a class='clslnk' href='./../Classes/FoaDecode.html'>FoaDecode</a>.ar(in, ~decoder);

                // reorder output to match speaker arrangement
                [fl, fr, bl, br]
            }
        { kind == '5.0' }
            {
                // decode (to 5.0)
	            "in 5.0".postln;
	            
                #fc, fl, bl, br, fr = <a class='clslnk' href='./../Classes/FoaDecode.html'>FoaDecode</a>.ar(in, ~decoder);
                lo = <a class='clslnk' href='./../Classes/Silent.html'>Silent</a>.ar;
                                
                // reorder output to match speaker arrangement
                [fl, fr, fc, lo, bl, br]
            }
        { kind == 'panto' }
            {
	            "in panto".postln;
	            
                // decode (to hex)
                #fl, sl, bl, br, sr, fr = <a class='clslnk' href='./../Classes/FoaDecode.html'>FoaDecode</a>.ar(in, ~decoder);
                                
                // reorder output to match speaker arrangement
                [fl, fr, sl, sr, bl, br]
            }
        { kind == 'peri' }
            {
	            "in peri".postln;
	            
                // decode (to cube)
                #flu, blu, bru, fru, fld, bld, brd, frd = <a class='clslnk' href='./../Classes/FoaDecode.html'>FoaDecode</a>.ar(in, ~decoder);
                                
                // reorder output to match speaker arrangement
                [flu, fru, blu, bru, fld, frd, bld, brd]
            }
        { kind == 'diametric' }
            {
	            "in diametric".postln;
	            
                // decode (to bi-rectangle)
                #fl, fr, slu, sru, br, bl, srd, sld = <a class='clslnk' href='./../Classes/FoaDecode.html'>FoaDecode</a>.ar(in, ~decoder);
                
                // reorder output to match speaker arrangement
                [fl, fr, bl, br, slu, sru, sld, srd]
            };
}
)

// ------------------------------------------------------------
// now we're ready to try the examples below!
// ------------------------------------------------------------
</pre>
<h3><a class='anchor' name='rotate'>Rotate</a></h3>
<p>Rotation is one of the most used soundfield transforms. In this case we'll it to centre the subject of a field recording.
<p>If you haven't already choose a <code class='code prettyprint lang-sc'> ~decoder</code>
 and defined <code class='code prettyprint lang-sc'> ~renderDecode </code>
, do so <a href="#choose_a_decoder">now</a>.
<div class='note'><span class='notelabel'>NOTE:</span> A matrix type transformer, see <a href="./../Classes/FoaXformerMatrix.html#*newRotate">FoaXformerMatrix: *newRotate</a> for further details.</div><pre class='code prettyprint lang-sc'>
// ------------------------------------------------------------
// rotate xformer
// b-format soundfile read from disk


// define xformer matrix
~xformer = <a class='clslnk' href='./../Classes/FoaXformerMatrix.html'>FoaXformerMatrix</a>.newRotate           // no rotation --&gt; try this 1st
~xformer = <a class='clslnk' href='./../Classes/FoaXformerMatrix.html'>FoaXformerMatrix</a>.newRotate(110/180 * pi.neg) // by -110deg   --&gt; try this 2nd


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels * 180/pi


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = <a class='clslnk' href='./../Classes/Buffer.html'>Buffer</a>.read(s, "sounds/ATK/b-format/Leonard-Chinook.wav")


(
{
    var sig;                            // audio signal


    // display xformer &amp; decoder
    "Ambisonic transforming via % xformer".format(~xformer.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = <a class='clslnk' href='./../Classes/PlayBuf.html'>PlayBuf</a>.ar(~sndbuf.numChannels, ~sndbuf, doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // transform
    sig = <a class='clslnk' href='./../Classes/FoaXform.html'>FoaXform</a>.ar(sig, ~xformer);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------
</pre>
<div class='note'><span class='notelabel'>NOTE:</span>  <strong>Soundfile Credits</strong><ul>
<li> J. Leonard, "A couple of Chinook helicopters," Sound of Space: ambisonic surround sound, 20-Mar-2008. [Online]. Available: <a href="http://soundofspace.com/ambisonic_files/47 ">http://soundofspace.com/ambisonic_files/47 </a>[Accessed: 03-Nov-2011].
</ul>
</div><h3><a class='anchor' name='mirroro'>MirrorO</a></h3>
<p>In mirroring through the origin and delaying the soundfield, we can generate a new set of echos in this fireworks field recording.
<p>If you haven't already choose a <code class='code prettyprint lang-sc'> ~decoder</code>
 and defined <code class='code prettyprint lang-sc'> ~renderDecode </code>
, do so <a href="#choose_a_decoder">now</a>.
<div class='note'><span class='notelabel'>NOTE:</span> A matrix type transformer, see <a href="./../Classes/FoaXformerMatrix.html#*newMirrorO">FoaXformerMatrix: *newMirrorO</a> for further details.</div><pre class='code prettyprint lang-sc'>
// ------------------------------------------------------------
// mirrorO xformer
// b-format soundfile read from disk


// define xformer matrix
~xformer = <a class='clslnk' href='./../Classes/FoaXformerMatrix.html'>FoaXformerMatrix</a>.newMirrorO


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels * 180/pi


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = <a class='clslnk' href='./../Classes/Buffer.html'>Buffer</a>.read(s, "sounds/ATK/b-format/Leonard-Fireworks.wav")


(
{
    var sig;                            // audio signal
    var delSig;                         // delayed signal
    var freq;                           // lp frequency
    var delay;                          // delay time
    var scale;                          // delay gain (as scale)

    // display xformer &amp; decoder
    "Ambisonic transforming via % xformer".format(~xformer.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // parameters
    freq = 1200;                        // in Hz
    delay = 0.5;                        // in seconds
    scale = 9.neg.dbamp;

    // ------------------------------------------------------------
    // test sig
    sig = <a class='clslnk' href='./../Classes/PlayBuf.html'>PlayBuf</a>.ar(~sndbuf.numChannels, ~sndbuf, doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // delay, lp and gain
    delSig = <a class='clslnk' href='./../Classes/LPF.html'>LPF</a>.ar(<a class='clslnk' href='./../Classes/DelayN.html'>DelayN</a>.ar(sig, delay, delay), freq, scale);

    // ------------------------------------------------------------
    // transform
    delSig = <a class='clslnk' href='./../Classes/FoaXform.html'>FoaXform</a>.ar(delSig, ~xformer);

    // ------------------------------------------------------------
    // sum (comment this out to hear original signal)
    sig = sig + delSig;
//    sig = delSig;                    // or listen to the mirrored sig

    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------
</pre>
<div class='note'><span class='notelabel'>NOTE:</span>  <strong>Soundfile Credits</strong><ul>
<li> J. Leonard, "Fireworks," Sound of Space: ambisonic surround sound, 25-Aug-2009. [Online]. Available: <a href="http://soundofspace.com/ambisonic_files/37 ">http://soundofspace.com/ambisonic_files/37 </a>[Accessed: 03-Nov-2011].
</ul>
</div><h3><a class='anchor' name='dominatex'>DominateX</a></h3>
<p>Dominance adjusts the gain of a soundfield in a particular direction. Here we'll increase the amount of reverberation in this natural soundfield recording. As the image is warped at the same time, we'll also hear the frontal stage widen.
<p>If you haven't already choose a <code class='code prettyprint lang-sc'> ~decoder</code>
 and defined <code class='code prettyprint lang-sc'> ~renderDecode </code>
, do so <a href="#choose_a_decoder">now</a>.
<div class='note'><span class='notelabel'>NOTE:</span> A matrix type transformer, see <a href="./../Classes/FoaXformerMatrix.html#*newDominateX">FoaXformerMatrix: *newDominateX</a> for further details.</div><pre class='code prettyprint lang-sc'>
// ------------------------------------------------------------
// dominateX xformer
// b-format soundfile read from disk


// define xformer matrix
~xformer = <a class='clslnk' href='./../Classes/FoaXformerMatrix.html'>FoaXformerMatrix</a>.newDominateX           // no dominance --&gt; try this 1st
~xformer = <a class='clslnk' href='./../Classes/FoaXformerMatrix.html'>FoaXformerMatrix</a>.newDominateX(-3.0)    // increase gain at rear


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels * 180/pi


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = <a class='clslnk' href='./../Classes/Buffer.html'>Buffer</a>.read(s, "sounds/ATK/b-format/Leonard-Orfeo_Trio.wav")


(
{
    var sig;                            // audio signal

    // display xformer &amp; decoder
    "Ambisonic transforming via % xformer".format(~xformer.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = <a class='clslnk' href='./../Classes/PlayBuf.html'>PlayBuf</a>.ar(~sndbuf.numChannels, ~sndbuf, doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // transform
    sig = <a class='clslnk' href='./../Classes/FoaXform.html'>FoaXform</a>.ar(sig, ~xformer);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------
</pre>
<div class='note'><span class='notelabel'>NOTE:</span>  <strong>Soundfile Credits</strong><ul>
<li> J. Leonard, "The Orfeo Trio &amp; TetraMic," Sound of Space: ambisonic surround sound. [Online]. Available: <a href="http://soundofspace.com/ambisonic_files/41 ">http://soundofspace.com/ambisonic_files/41 </a>[Accessed: 03-Nov-2011].
</ul>
</div><div class='doclink'>source: <a href='file:///Users/josephla/Applications/Sound/SuperColliderJuan/HelpSource/Classes/FoaXform.schelp'>/Users/josephla/Applications/Sound/SuperColliderJuan/HelpSource/Classes/FoaXform.schelp</a></div></div></body></html>